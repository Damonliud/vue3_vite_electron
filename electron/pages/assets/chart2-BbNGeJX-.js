import{i as A}from"./index-Bb6yjXMn.js";import{_ as F,u as M,s as T,r as m,m as z,n as O,p as D,a as q,b as c,i as W,w as i,f,F as R,h as v,l as k,d as E,k as $,E as g}from"./index-Do4brRv3.js";const j={__name:"chart2",setup(H){let L=M(),{excelData:p}=T(L);const h=m(),y=m([]),_=m([]),s=m([]),a=m({quarterRelated1:"",quarterRelated2:""}),C=async r=>{if(Object.keys(p.value).length==0){g.error("请先导入Excel");return}await r.validate((e,o)=>{if(e){y.value=[a.value.quarterRelated1,a.value.quarterRelated2];let t=s.value.find(n=>n.label==a.value.quarterRelated1).value,l=s.value.find(n=>n.label==a.value.quarterRelated2).value;_.value=[Number(t),Number(l)],x(y.value,_.value)}else console.log("error submit!",o)})};z(p,()=>{a.value.quarterRelated1="",a.value.quarterRelated2=""},{deep:!0,immediate:!0});let d=null;O(()=>{S(),Object.keys(p.value).length!=0&&(s.value=[],s.value=N(p.value),s.value.length>0&&!a.value.quarterRelated1&&(a.value.quarterRelated1=a.value.quarterRelated1||s.value[0].label),s.value.length>1&&!a.value.quarterRelated2&&(a.value.quarterRelated2=a.value.quarterRelated2||s.value[1].label),C(h.value))});let N=r=>{const e=new Map;for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const l=r[t],n=t.match(/^(Quarter_\d+)/);if(!n){console.warn(`警告: 键 "${t}" 不符合预期的 "Quarter_X" 格式，已跳过。`);continue}const b=n[1],u=l.reduce((P,U)=>{const V=Number(U.weightedVelocity);return P+(isNaN(V)?0:V)},0),I=e.get(b)||0;e.set(b,I+u)}const o=[];for(const[t,l]of e.entries())o.push({value:Number(l.toFixed(2)),label:t});return o};D(()=>{d&&(d.dispose(),d=null),window.removeEventListener("resize",w)});function S(){const r=document.getElementById("myEcharts");r?(d=A(r),window.addEventListener("resize",w),x(y.value,_.value)):console.error("ECharts 容器 DOM 元素未找到！请检查HTML结构和ID。")}function w(){d&&d.resize()}function x(r=[],e=[]){if(!d){console.error("ECharts 实例未初始化或已销毁！无法更新图表。");return}let o="";if(e.length>=2){const t=e[0];console.log("firstValue:",t);const l=e[e.length-1];if(console.log("lastValue:",l),t!==0){const n=(l-t)/t*100;o=`${n>0?"+":""}${n.toFixed(2)}%`,n===0&&(o="持平 (0.00%)")}else o=l>0?"无限增长":"0%"}d.setOption({title:{subtext:`从 ${r[0]} 到 ${r[r.length-1]} 的变化：${o}`,left:"center"},xAxis:{type:"category",data:r},tooltip:{trigger:"axis"},yAxis:{type:"value"},series:[{data:e,type:"line",itemStyle:{normal:{label:{show:!0}}}}]})}const Q=()=>{B("png",1,"Quarter Chart")},B=(r="png",e=1,o="chart")=>{if(!d){g.error("图表未初始化，无法导出！");return}try{const t=d.getDataURL({type:r,pixelRatio:e,backgroundColor:"#fff"}),l=document.createElement("a");l.href=t,l.download=`${o}.${r}`,document.body.appendChild(l),l.click(),document.body.removeChild(l),g.success(`图表导出为 ${r.toUpperCase()} 成功！`)}catch(t){console.error("导出图表失败:",t),g.error(`导出图表为 ${r.toUpperCase()} 失败，请检查控制台。`)}};return(r,e)=>{const o=f("el-option"),t=f("el-select"),l=f("el-form-item"),n=f("el-button"),b=f("el-form");return v(),q(R,null,[c(b,{ref_key:"formRef",ref:h,inline:!0,model:a.value,class:"demo-form-inline"},{default:i(()=>[c(l,{label:"Quarter",prop:"quarterRelated1",rules:[{required:!0,message:"Please Select",trigger:"blur"}]},{default:i(()=>[c(t,{modelValue:a.value.quarterRelated1,"onUpdate:modelValue":e[0]||(e[0]=u=>a.value.quarterRelated1=u),placeholder:"Please Select",clearable:""},{default:i(()=>[(v(!0),q(R,null,k(s.value,u=>(v(),E(o,{key:u.label,label:u.label,value:u.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),c(l,{label:"Quarter",prop:"quarterRelated2",rules:[{required:!0,message:"Please Select",trigger:"blur"}]},{default:i(()=>[c(t,{modelValue:a.value.quarterRelated2,"onUpdate:modelValue":e[1]||(e[1]=u=>a.value.quarterRelated2=u),placeholder:"Please Select",clearable:""},{default:i(()=>[(v(!0),q(R,null,k(s.value,u=>(v(),E(o,{key:u.label,label:u.label,value:u.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),c(l,null,{default:i(()=>[c(n,{type:"primary",onClick:e[2]||(e[2]=u=>C(h.value))},{default:i(()=>e[3]||(e[3]=[$("Query")])),_:1,__:[3]})]),_:1}),c(l,null,{default:i(()=>[c(n,{type:"primary",onClick:Q},{default:i(()=>e[4]||(e[4]=[$("Export Chart")])),_:1,__:[4]})]),_:1})]),_:1},8,["model"]),e[5]||(e[5]=W("div",{id:"myEcharts",style:{width:"100%",height:"300px"}},null,-1))],64)}}},J=F(j,[["__scopeId","data-v-c3a5d995"]]);export{J as default};
