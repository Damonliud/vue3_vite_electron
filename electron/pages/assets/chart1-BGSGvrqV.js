import{i as U}from"./index-Bb6yjXMn.js";import{_ as B,u as F,r as v,s as N,m as P,n as z,p as O,a as h,b as i,i as Q,w as c,f,F as q,h as p,l as k,d as V,k as w,E as b}from"./index-Do4brRv3.js";const T={__name:"chart1",setup(M){let E=F();const g=v(),R=v([]),_=v([]);let{excelData:m}=N(E);const n=v([]),a=v({quarterRelated1:"",quarterRelated2:""}),y=async l=>{if(Object.keys(m.value).length==0){b.error("请先导入Excel");return}await l.validate((e,u)=>{if(e){R.value=[a.value.quarterRelated1,a.value.quarterRelated2];let r=n.value.find(d=>d.label==a.value.quarterRelated1).value,t=n.value.find(d=>d.label==a.value.quarterRelated2).value;_.value=[Number(r),Number(t)],x(R.value,_.value)}else console.log("error submit!",u)})};P(m,()=>{a.value.quarterRelated1="",a.value.quarterRelated2=""},{deep:!0,immediate:!0});let s=null;z(()=>{if($(),Object.keys(m.value).length!=0){n.value=[];for(const l in m.value){let u=m.value[l].reduce((r,t)=>r+t.weightedVelocity,0);n.value.push({value:u.toFixed(2),label:l})}n.value.length>0&&!a.value.quarterRelated1&&(a.value.quarterRelated1=a.value.quarterRelated1||n.value[0].label),n.value.length>1&&!a.value.quarterRelated2&&(a.value.quarterRelated2=a.value.quarterRelated2||n.value[1].label),y(g.value)}}),O(()=>{s&&(s.dispose(),s=null),window.removeEventListener("resize",C)});function $(){const l=document.getElementById("myEcharts");l?(s=U(l),window.addEventListener("resize",C),x(R.value,_.value)):console.error("ECharts 容器 DOM 元素未找到！请检查HTML结构和ID。")}function C(){s&&s.resize()}function x(l=[],e=[]){if(!s){console.error("ECharts 实例未初始化或已销毁！无法更新图表。");return}let u="";if(e.length>=2){const r=e[0];console.log("firstValue:",r);const t=e[e.length-1];if(console.log("lastValue:",t),r!==0){const d=(t-r)/r*100;u=`${d>0?"+":""}${d.toFixed(2)}%`,d===0&&(u="持平 (0.00%)")}else u=t>0?"无限增长":"0%"}s.setOption({title:{subtext:`从 ${l[0]} 到 ${l[l.length-1]} 的变化：${u}`,left:"center"},xAxis:{type:"category",data:l},tooltip:{trigger:"axis"},yAxis:{type:"value"},series:[{data:e,type:"line",itemStyle:{normal:{label:{show:!0}}}}]})}const L=()=>{I("png",1,"Quarter Related Chart")},I=(l="png",e=1,u="chart")=>{if(!s){b.error("图表未初始化，无法导出！");return}try{const r=s.getDataURL({type:l,pixelRatio:e,backgroundColor:"#fff"}),t=document.createElement("a");t.href=r,t.download=`${u}.${l}`,document.body.appendChild(t),t.click(),document.body.removeChild(t),b.success(`图表导出为 ${l.toUpperCase()} 成功！`)}catch(r){console.error("导出图表失败:",r),b.error(`导出图表为 ${l.toUpperCase()} 失败，请检查控制台。`)}};return(l,e)=>{const u=f("el-option"),r=f("el-select"),t=f("el-form-item"),d=f("el-button"),S=f("el-form");return p(),h(q,null,[i(S,{ref_key:"formRef",ref:g,inline:!0,model:a.value,class:"demo-form-inline"},{default:c(()=>[i(t,{label:"Quarter Related",prop:"quarterRelated1",rules:[{required:!0,message:"Please Select",trigger:"blur"}]},{default:c(()=>[i(r,{modelValue:a.value.quarterRelated1,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.quarterRelated1=o),placeholder:"Please Select",clearable:""},{default:c(()=>[(p(!0),h(q,null,k(n.value,o=>(p(),V(u,{key:o.label,label:o.label,value:o.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(t,{label:"Quarter Related",prop:"quarterRelated2",rules:[{required:!0,message:"Please Select",trigger:"blur"}]},{default:c(()=>[i(r,{modelValue:a.value.quarterRelated2,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.quarterRelated2=o),placeholder:"Please Select",clearable:""},{default:c(()=>[(p(!0),h(q,null,k(n.value,o=>(p(),V(u,{key:o.label,label:o.label,value:o.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(t,null,{default:c(()=>[i(d,{type:"primary",onClick:e[2]||(e[2]=o=>y(g.value))},{default:c(()=>e[3]||(e[3]=[w("Query")])),_:1,__:[3]})]),_:1}),i(t,null,{default:c(()=>[i(d,{type:"primary",onClick:L},{default:c(()=>e[4]||(e[4]=[w("Export Chart")])),_:1,__:[4]})]),_:1})]),_:1},8,["model"]),e[5]||(e[5]=Q("div",{id:"myEcharts",style:{width:"100%",height:"300px"}},null,-1))],64)}}},D=B(T,[["__scopeId","data-v-af6fc305"]]);export{D as default};
