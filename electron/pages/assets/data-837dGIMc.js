import{r as j,u as A}from"./xlsx-BWspZQq9.js";import{r as i,c as C,s as R,u as S,o as V,a as D,b as f,w as m,d as N,e as M,f as g,g as O,h as B,i as P,E as F}from"./index-D8pEwVCS.js";const G={__name:"data",setup(I){i([]),C(()=>Object.keys(d.value).length!=0);let h=S(),{relatedExcelData:d}=R(h),{setRelatedExcelData:_,setQuarterExcelData:b}=h;const p=i([]),w=i([]);i([]),V(()=>{Object.keys(d.value).length!=0&&(p.value=d.value)});const T=o=>new Promise((a,s)=>{const e=new FileReader;e.readAsArrayBuffer(o.raw),e.onload=r=>{a(r.target.result)},e.onerror=r=>{s(r)}}),v=async o=>{const a=await E(o);let s=k(a);p.value=Q(s),_(p.value),w.value=x(s),b(w.value),F.success("Excel 文件导入成功！")},x=o=>{const a=new Map;o.forEach(e=>{if(e.Quarter!==void 0){const r=`Quarter_${e.Quarter}`;a.has(r)||a.set(r,[]),a.get(r).push(e)}else console.warn("数据项缺少 'Quarter'字段，已跳过分组:",e)});const s={};for(const[e,r]of a.entries()){const n=r.reduce((l,t)=>{const c=Number(t.cycleTime);return l+(isNaN(c)?0:c)},0),y=r.map(l=>{const t={...l},c=Number(t.cycleTime),u=Number(t.velocity);return n!==0&&!isNaN(c)?t.weight=c/n:t.weight=0,!isNaN(t.weight)&&!isNaN(u)?t.weightedVelocity=t.weight*u:t.weightedVelocity=0,t});s[e]=y}return s},E=async o=>{const a=await T(o),s=j(a),e=s.Sheets[s.SheetNames[0]];return A.sheet_to_json(e)},k=o=>{const a=[],s={Projects:"project","Total Story Points per PRD":"pointsPerPrd","Cycle Time (Day)":"cycleTime",Velocity:"velocity",Quarter:"Quarter","Related with":"Related"};return o.forEach(e=>{const r={};Object.keys(e).forEach(n=>{r[s[n]]=e[n]}),a.push(r)}),a};function Q(o){const a=new Map;o.forEach(e=>{if(e.Quarter!==void 0&&e.Related!==void 0){const r=`Quarter_${e.Quarter} Related_${e.Related}`;a.has(r)||a.set(r,[]),a.get(r).push(e)}else console.warn("数据项缺少 'Quarter' 或 'Related' 字段，已跳过分组:",e)});const s={};for(const[e,r]of a.entries()){const n=r.reduce((l,t)=>{const c=Number(t.cycleTime);return l+(isNaN(c)?0:c)},0),y=r.map(l=>{const t={...l},c=Number(t.cycleTime),u=Number(t.velocity);return n!==0&&!isNaN(c)?t.weight=c/n:t.weight=0,!isNaN(t.weight)&&!isNaN(u)?t.weightedVelocity=t.weight*u:t.weightedVelocity=0,t});s[e]=y}return s}return(o,a)=>{const s=N("el-icon"),e=N("el-upload");return M(),D("div",null,[f(e,{class:"upload-demo","on-change":v,accept:".xls,.xlsx","auto-upload":!1,"show-file-list":!1,multiple:!0,drag:""},{default:m(()=>[f(s,{class:"el-icon--upload"},{default:m(()=>[f(O(B))]),_:1}),a[0]||(a[0]=g("div",{class:"el-upload__text"},[P("将文件拖到此处或 "),g("em",null,"点击上传")],-1))]),_:1,__:[0]})])}}};export{G as default};
